<html>
  <head>
    <title>Beach Houses</title>
    <style>
    td img {
      height: 80pt;
    }
    table, th, td {
      border-collapse: collapse;
      border: 1pt solid rgb(200,200,200);
      padding: 15pt;
      color: rgb(50,50,50);
    }
    tbody {
      overflow: scroll;
      height: 100pt;
    }
    #header {
      margin-bottom: 1em;
      color: rgb(150,150,150);
    }
    #house_count {
      font-size: 1.7em;
      color: #588c7e;
      font-weight: bold;
    }
    #search_params {
    }
    .search_param_section {
      margin-right: 20pt;
    }
    #saved_searches {

    }
    #saved_searches a {
      margin-right: 20pt;
    }
    #realty_list {
    }
    a {
      color: #d96459;
    }
    input.date_input {
      width: 80pt;
    }
    input#submit_button {
      color: #d96459;
      border: 1px solid #d96459;
      cursor: pointer;
      background-color: #fff;
    }
    input#submit_button:hover {
      background-color:rgb(230,230,230)
    }
    </style>
  </head>
  <body>
      <div id="header">
        <div id="house_count">{{ house_count }} houses found</div>
        <div id="search_params">
          <form>
            <input type="submit" value="search beach houses" id="submit_button"/>

            <select name="sort">
              <option value="" {% if sorted_by is None %}selected="selected"{% end %}>sort by none</option>
              <option value="cost" {% if sorted_by is "cost" %}selected="selected"{% end %}>sort by cost</option>
              <option value="beds" {% if sorted_by is "beds" %}selected="selected"{% end %}>sort by bedrooms</option>
            </select>

            <select name="4x4">
              <option value="" {% if four_by_four is None %}selected="selected"{% end %}>search all territories</option>
              <option value="false" {% if four_by_four and four_by_four.lower() == "false" %}selected="selected"{% end %}>exclude 4x4</option>
              <option value="true" {% if four_by_four and four_by_four.lower() == "true" %}selected="selected"{% end %}>include only 4x4</option>
            </select>
            <select name="oceanfront">
              <option value="true" {% if oceanfront and oceanfront.lower() == "true" %}selected="selected"{% end %}>oceanfront only</option>
              <option value="false" {% if oceanfront is None or oceanfront.lower() == "false" %}selected="selected"{% end %}>all homes</option>
            </select>

            start date:
            <input type="text" name="start_date" value="{{start_date or ""}}" placeholder="yyyy-mm-dd" class="date_input"/>
            end date:
            <input type="text" name="end_date" value="{{end_date or ""}}" placeholder="yyyy-mm-dd" class="date_input"/>
             (yyyy-mm-dd)
          </form>
          <!--
      <span class="search_param_section">
        Currently searching:
        {% if oceanfront and oceanfront.lower() == "true" %}
          Oceanfront
        {% else %}
          All
        {% end %}
        homes
      </span>
      <span class="search_param_section">
        {% if four_by_four and four_by_four.lower() == "true" %}
        4x4 houses: Only these
        {% elif four_by_four and four_by_four.lower() == "false" %}
        4x4 houses: Excluded
        {% else %}
        {% end %}
      </span>
      <span class="search_param_section">
        Sorted by:
        {{ sorted_by }}
      </span>
    -->
    </div>
        <div id="saved_searches">
          Saved searches:
        <a href="?">view all houses</a>

        <a href="?sort=beds&oceanfront=true&4x4=false">search oceanfront, no 4x4, sort by beds</a>

        <a href="?sort=beds&oceanfront=true&4x4=false&start_date=2019-06-01&end_date=2019-08-01">search oceanfront, no 4x4, sort by beds, just summer 2019</a>
      </div>
      <div id="realty_list">
        (Currently searching: Twiddy, Carolina Beach Realty, Beach Realty NC.)
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Agency</th>
          <th>Photo</th>
          <th>Name</th>
          <th>Location</th>
          <th>Highest Cost</th>
          <th>Capacity</th>
          <th>Cost per bed</th>
          <th>Link</th>
          <th>Last updated from rental agency</th>
          {% for arrival_date in arrival_dates %}
          <th>
            {{ datetime.datetime.fromtimestamp(978285600 + arrival_date).strftime("%b %-d, %Y") }}
          </th>
          {% end %}
          <!-- <th>Availabilities</th> -->
        </tr>
      </thead>
      <tbody>
        {% for house in houses %}
      <tr>
        {% block house %}
          <td>{{ house.get("rentalAgency", "") }}</td>
          <td>
            {% if house.get("images") %}
            <a href="{{ house.get("images")[0] }}" target="_blank"><img src="{{ house.get("images")[0] }}"/></a>
            {% end %}
          </td>
          <td>{{ house["name"] }}</td>
          <td>
            {{ house.get("regionName", "??") }}
            [<a href="http://maps.google.com/?q={{ house.get("latitude", "") }},{{ house.get("longitude", "") }}" target=_blank>map it</a>]
            [<a href="?nearby_lat={{ house.get("latitude", "") }}&nearby_long={{ house.get("longitude", "") }}">nearby</a>]
          </td>
          <td>${{ house.get("maxRate", "?") }}</td>
          <td>{{ house.get("bedrooms", "?") }} bed / {{ house.get("bathrooms", "?") }} bath</td>
          <td>${{ round(house.get("maxRate", 0) / house.get("bedrooms", 1)) }}</td>
          <td><a href="{{ house.get("url", "") }}" target=_blank>{{ house.get("url", "")[:60] }}&hellip;</a></td>
          <td>{{ datetime.datetime.fromtimestamp(978285600 + house.get("updatedOn")).strftime("%b %-d, %Y") }} </td>

            {% if house.get("availability") %}
              {% for arrival_date in arrival_dates %}
                <td>
                  {% for availability in house.get("availability") %}
                    {% if availability.get("isAvailable") and (availability.get("arrivalDate") == arrival_date) or (availability.get("arrivalDate") - 86400 == arrival_date) or (availability.get("arrivalDate") + 86400 == arrival_date) %}
                      ${{ round(availability.get("totalCost")) }}
                      {% break %}
                    {% end %}
                  {% end %}
                </td>
              {% end %}
            {% end %}
        {% end %}
      </tr>
      {% end %}
    </tbody>
    </table>
  </body>
</html>
